language: cpp
before_install:
- sudo apt-get install -y python-serial srecord
install:
- tar -zxvf tools/esp-open-sdk.tar.gz
- export PATH=$PATH:$PWD/esp-open-sdk/sdk:$PWD/esp-open-sdk/xtensa-lx106-elf/bin
script:
- make all
- cd bin/
- file_name_float="nodemcu_float_${TRAVIS_TAG}.bin"
- srec_cat -output ${file_name_float} -binary 0x00000.bin -binary -fill 0xff 0x00000 0x10000 0x10000.bin -binary -offset 0x10000
- cd ../
- make clean
- make EXTRA_CCFLAGS="-DLUA_NUMBER_INTEGRAL"
- cd bin/
- file_name_integer="nodemcu_integer_${TRAVIS_TAG}.bin"
- srec_cat -output ${file_name_integer} -binary 0x00000.bin -binary -fill 0xff 0x00000 0x10000 0x10000.bin -binary -offset 0x10000
deploy:
  provider: releases
  api_key:
    secure: hnVxvN+tUSI4LtLIXHoBuEPY66f+nOGHq7Fw3uXwu4qtKs89hFyxNTu/I9V/3dvlQ5vLOccNKvaesPGaBz+pYqVZZWjJ7NruV35CorNh1J8eFkrALHYPeTy1D2NL4gEuhe4pd72Jq0Iotuzky8ZFuW/w16hxPHPSRPYZc+Iv9SoaWZ49S1P4qL7BRf65215UlOQOt2aSkVWMNZ0Cvtlo5fURyGQGQF/eD7BBrl35mmDcl6voOcFMpnII+aFL6kiORbwdWJ0x1O53v0Pmm8DGP8fe6uVZbQstyaCaLghPJKg5e8BBrJ41lAKDjYAjK1LajsnYq4TtV7jVh9R0J/+IUe37AokFJyLm6geKCW//vYZHSPoCdnASwD59ADvnw+Ui3fmPh0jmqJTkcb3AyVRKv1CrXWnRQwxla1u46WuOaPeVdhpo/yBiOtifRXZbuBDxwpkCfAVgiXc6F2gkA6EhuYtaPU6urpL+d7VxH6loZSSn5OHokWpQ3/GSzkA+X14poTbY1WwyJwdLjepS5IMunyMOaiCW2E5XYqung/OK3gujfJ/ANJre92ccVmeHaAquiIom65Wu+11eh7AHHYreW1dxOKvEAzicaAEYfObNfucVNJcpeKbhkNabSzreL0BjMK4L2apRLFjpiCC+XQGp1p9+wQEb5FrvHowzEIZkc1k=
  file:
    - "$TRAVIS_BUILD_DIR/bin/${file_name_float}"
    - "$TRAVIS_BUILD_DIR/bin/${file_name_integer}"
  skip_cleanup: true
  on:
    tags: true
    repo: jonn26/nodemcu-firmware
